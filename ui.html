<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        font-size: 9pt;
        margin: 0;
        padding: 0px;
        background-color: #2c2c2c;
        color: #ffffff;
      }
      .eyebrow {
        font-size: 8pt; /* 8pt font size */
        text-transform: none; /* All caps */
        font-weight: bold; /* Bold font */
        margin-top: 0;
        color: #ffffff;
        padding: 12px; /* Should be 12px */
      }
      ul {
        list-style-type: none; /* Removes bullets */
        padding: 0;
        padding-bottom: 0px;
        margin: 0;
      }
      li {
        margin-bottom: 4px; /* Increases line spacing. Was 8, now 4 */
        cursor: pointer;
      }
      .frame-list {
        margin-top: 20px;
      }

      .frame-item {
        display: flex;
        align-items: center;
        justify-content: flex-start; /* Align items to the left */
        height: 32px; /* Set the height of each row */
        padding: 0 16px; /* Padding for some space on the sides */
      }

      /* Style for history list items */
      .history-item {
        display: flex;
        align-items: center;
        justify-content: space-between; /* Keep items on each end */
        height: 32px;
        padding: 0 16px;
      }

      /* Style for favorite list items */
      .favorite-item {
        display: flex;
        align-items: center;
        justify-content: flex-start; /* Align items to the left */
        height: 32px;
        padding: 0 12px;
      }

      .page-name-style {
        color: #888888;
      }

      /* Style for star icon in favorite list */
      .favorite-star-icon {
        cursor: pointer;
        margin-right: 6px; /* Space between star and frame name */
      }

      .star-icon {
        cursor: pointer;
        margin-right: 4px; /* Adjust the space between the star and the frame name */
      }
    </style>
  </head>
  <body>
    <div class="eyebrow" id="favoriteFramesTitle">FAVORITES</div>
    <ul id="favoriteList"></ul>

    <div class="eyebrow">HISTORY</div>
    <ul id="frameList"></ul>

    <div class="eyebrow" id="clearData" style="color: #bfbfbf; cursor: pointer">
      Clear Data
    </div>

    <script>
      let history = [];
      let currentIndex = -1;
      let favorites = [];

      function updatePluginData() {
        const data = { history, currentIndex, favorites };
        parent.postMessage({ pluginMessage: data }, "*");
      }

      function updateFrameList(historyData, currentFrameId) {
        const list = document.getElementById("frameList");
        list.innerHTML = "";
        let currentFrameFound = false;

        historyData.forEach((frame) => {
          const listItem = document.createElement("li");
          listItem.classList.add("history-item");

          const frameName = document.createElement("span");
          frameName.textContent = frame.name;

          const truncatedPageName =
            frame.pageName.length > 32
              ? frame.pageName.substring(0, 29) + "..."
              : frame.pageName;

          const pageNameSpan = document.createElement("span");
          pageNameSpan.textContent = " (" + truncatedPageName + ")";
          pageNameSpan.className = "page-name-style";
          frameName.appendChild(pageNameSpan);

          frameName.onclick = () => jumpToFrame(frame.id, frame.pageId);
          listItem.appendChild(frameName);

          const star = document.createElement("span");
          star.classList.add("star-icon");
          star.textContent = favorites.some((fav) => fav.id === frame.id)
            ? "★"
            : "☆";
          star.onclick = () => toggleFavorite(frame, historyData);
          listItem.appendChild(star);

          if (frame.id === currentFrameId && !currentFrameFound) {
            listItem.style.backgroundColor = "#4D5875";
            currentFrameFound = true;
          }

          list.appendChild(listItem);
        });
      }

      function updateFavoriteList() {
        const list = document.getElementById("favoriteList");
        list.innerHTML = "";
        favorites.forEach((frame) => {
          const listItem = document.createElement("li");
          listItem.classList.add("favorite-item");

          const star = document.createElement("span");
          star.classList.add("favorite-star-icon");
          star.textContent = "★";
          star.onclick = () => toggleFavorite(frame);
          listItem.appendChild(star);

          const frameName = document.createElement("span");
          frameName.textContent = frame.name;

          const pageNameSpan = document.createElement("span");
          pageNameSpan.className = "page-name-style";
          frameName.appendChild(pageNameSpan);

          frameName.onclick = () => jumpToFrame(frame.id, frame.pageId);
          listItem.appendChild(frameName);

          list.appendChild(listItem);
        });
      }

      function toggleFavorite(frame, historyData = null) {
        const isFavorite = favorites.some((fav) => fav.id === frame.id);
        if (isFavorite) {
          favorites = favorites.filter((fav) => fav.id !== frame.id);
        } else {
          favorites.push({
            id: frame.id,
            name: frame.name,
            pageId: frame.pageId,
            pageName: frame.pageName,
            isSection: frame.isSection || false,
          });
        }
        parent.postMessage(
          { pluginMessage: { type: "updateFavorites", favorites: favorites } },
          "*"
        );
      }

      function jumpToFrame(frameId, pageId) {
        parent.postMessage(
          { pluginMessage: { type: "jumpToFrame", frameId, pageId } },
          "*"
        );
      }

  // Function to handle the 'Clear Data' button click
  document.getElementById("clearData").onclick = function () {
    // Reset local history, currentIndex, and favorites
    history = [];
    currentIndex = -1;
    favorites = [];

    // Update the frame list and favorites list in the UI to reflect the cleared data
    updateFrameList([]);
    updateFavoriteList();

    // Send a message to the main plugin script to clear the data there as well
    parent.postMessage({ pluginMessage: { type: "clearData" } }, "*");
  };

      window.onmessage = (event) => {
        const {
          type,
          historyData,
          currentFrameId,
          favorites: updatedFavorites,
        } = event.data.pluginMessage;
        if (type === "update") {
          history = historyData;
          currentIndex = historyData.findIndex(
            (frame) => frame.id === currentFrameId
          );
          favorites = updatedFavorites;
          updateFrameList(historyData, currentFrameId);
          updateFavoriteList();
        }
      };
    </script>
  </body>
</html>
